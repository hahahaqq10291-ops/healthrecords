{% extends "shared/base.html" %} {% block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/student_list.css') }}"
/>
<style>
  .inventory-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    gap: 20px;
  }

  .inventory-header h1 {
    font-size: 32px;
    color: #2f3640;
    font-weight: 600;
  }

  .section-title {
    margin-top: 40px;
    margin-bottom: 20px;
    font-size: 22px;
    font-weight: bold;
    border-bottom: 3px solid #a83e51;
    padding-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .inventory-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 30px;
    background-color: #fff;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .inventory-table th {
    background-color: #a83e51;
    color: white;
    padding: 15px;
    text-align: left;
    font-weight: 600;
    border: none;
  }

  .inventory-table td {
    padding: 12px 15px;
    border-bottom: 1px solid #e0e0e0;
  }

  .inventory-table tbody tr {
    transition: background-color 0.2s;
  }

  .inventory-table tbody tr:hover {
    background-color: #f9f9f9;
  }

  .inventory-table tbody tr:last-child td {
    border-bottom: none;
  }

  .item-name {
    font-weight: 600;
    color: #2f3640;
  }

  .quantity-cell {
    text-align: center;
    font-weight: 600;
  }

  .status-badge {
    display: inline-block;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
  }

  .status-available {
    background-color: #d4edda;
    color: #155724;
  }

  .status-unavailable {
    background-color: #f8d7da;
    color: #721c24;
  }

  .quantity-badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: bold;
    margin-left: 5px;
  }

  .quantity-high {
    background-color: #d4edda;
    color: #155724;
  }

  .quantity-medium {
    background-color: #fff3cd;
    color: #856404;
  }

  .quantity-low {
    background-color: #f8d7da;
    color: #721c24;
  }

  .expiry-date {
    font-size: 12px;
    color: #666;
  }

  .expiry-soon {
    color: #dc3545;
    font-weight: bold;
  }

  .supplier-info {
    font-size: 12px;
    color: #666;
  }

  .notes-cell {
    font-size: 12px;
    color: #666;
    max-width: 200px;
  }

  .summary-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
  }

  .summary-card {
    background-color: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    border-left: 4px solid #007bff;
  }

  .summary-card h3 {
    margin: 0 0 10px 0;
    color: #2f3640;
    font-size: 14px;
    font-weight: 600;
    text-transform: uppercase;
  }

  .summary-card .count {
    font-size: 28px;
    font-weight: bold;
    color: #007bff;
  }

  .summary-card.warning {
    border-left-color: #ffc107;
  }

  .summary-card.warning .count {
    color: #ffc107;
  }

  .summary-card.danger {
    border-left-color: #dc3545;
  }

  .summary-card.danger .count {
    color: #dc3545;
  }

  .empty-state {
    text-align: center;
    padding: 40px;
    color: #999;
  }

  .button-group {
    display: flex;
    gap: 10px;
  }

  .btn {
    display: inline-block;
    padding: 10px 20px;
    background-color: #8f2f41;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    font-size: 14px;
    font-weight: 600;
    transition: background-color 0.3s;
  }

  .btn:hover {
    background-color: #a83e51;
  }

  .btn-danger {
    background-color: #dc3545;
  }

  .btn-danger:hover {
    background-color: #c82333;
  }

  .action-cell {
    text-align: center;
  }

  .action-btns {
    display: flex;
    gap: 5px;
    justify-content: center;
  }

  .btn-sm {
    padding: 4px 8px;
    font-size: 12px;
  }

  /* Modal Styles */
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.4);
    animation: fadeIn 0.3s;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  .modal.show {
    display: block;
  }

  .modal-content {
    background-color: #fefefe;
    margin: 5% auto;
    padding: 30px;
    border: 1px solid #888;
    border-radius: 8px;
    width: 90%;
    max-width: 600px;
    animation: slideIn 0.3s;
    max-height: 90vh;
    overflow-y: auto;
  }

  @keyframes slideIn {
    from {
      transform: translateY(-50px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .modal-header h2 {
    margin: 0;
    color: #2f3640;
    font-size: 24px;
  }

  .modal-close {
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: #999;
    transition: color 0.2s;
  }

  .modal-close:hover {
    color: #333;
  }

  .form-group-modal {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .form-row-modal {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
  }

  .form-group-modal label {
    font-weight: 600;
    color: #2f3640;
    margin-bottom: 5px;
  }

  .form-group-modal input,
  .form-group-modal select,
  .form-group-modal textarea {
    padding: 10px 12px;
    border: 1px solid #dcdde1;
    border-radius: 5px;
    font-size: 14px;
    font-family: inherit;
    outline: none;
    transition: border-color 0.2s;
  }

  .form-group-modal input:focus,
  .form-group-modal select:focus,
  .form-group-modal textarea:focus {
    border-color: #a83e51;
  }

  .form-group-modal textarea {
    resize: vertical;
    min-height: 70px;
  }

  .required {
    color: #dc3545;
  }

  .help-text {
    font-size: 12px;
    color: #666;
    margin-top: 3px;
  }

  .modal-buttons {
    display: flex;
    gap: 10px;
    margin-top: 25px;
  }

  .modal-buttons button {
    flex: 1;
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 600;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
  }

  .btn-submit-modal {
    background-color: #8f2f41;
    color: white;
  }

  .btn-submit-modal:hover {
    background-color: #a83e51;
  }

  .btn-cancel-modal {
    background-color: #e0e0e0;
    color: #333;
  }

  .btn-cancel-modal:hover {
    background-color: #d0d0d0;
  }

  /* Delete Confirmation Modal */
  .delete-modal {
    display: none;
    position: fixed;
    z-index: 2000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    animation: fadeIn 0.3s;
  }

  .delete-modal.show {
    display: block;
  }

  .delete-modal-content {
    background-color: #fefefe;
    margin: 20% auto;
    padding: 30px;
    border: 1px solid #dc3545;
    border-radius: 8px;
    width: 90%;
    max-width: 400px;
    animation: slideIn 0.3s;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
  }

  .delete-modal-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
  }

  .delete-modal-header i {
    font-size: 28px;
    color: #dc3545;
  }

  .delete-modal-header h3 {
    margin: 0;
    color: #dc3545;
    font-size: 18px;
  }

  .delete-modal-body {
    color: #333;
    margin-bottom: 20px;
    font-size: 14px;
    line-height: 1.6;
  }

  .delete-modal-buttons {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
  }

  .delete-modal-buttons button {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: background-color 0.3s;
  }

  .delete-confirm-btn {
    background-color: #dc3545;
    color: white;
  }

  .delete-confirm-btn:hover {
    background-color: #c82333;
  }

  .delete-cancel-btn {
    background-color: #e0e0e0;
    color: #333;
  }

  .delete-cancel-btn:hover {
    background-color: #d0d0d0;
  }

  @media screen and (max-width: 768px) {
    .inventory-table {
      font-size: 12px;
    }

    .inventory-table th,
    .inventory-table td {
      padding: 8px 10px;
    }

    .inventory-header {
      flex-direction: column;
      align-items: flex-start;
    }

    .inventory-header h1 {
      font-size: 24px;
    }

    .summary-cards {
      grid-template-columns: 1fr;
    }

    .button-group {
      flex-direction: column;
      width: 100%;
    }

    .btn {
      width: 100%;
    }

    .form-row-modal {
      grid-template-columns: 1fr;
    }

    .modal-content {
      width: 95%;
      margin: 20% auto;
      padding: 20px;
    }
  }

  /* Search and Pagination Styles */
  .search-container {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .search-input-group {
    display: flex;
    gap: 10px;
    flex: 1;
    min-width: 250px;
  }

  .search-input-group input {
    flex: 1;
    padding: 10px 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
  }

  .search-input-group input:focus {
    outline: none;
    border-color: #a83e51;
    box-shadow: 0 0 5px rgba(168, 62, 81, 0.3);
  }

  .pagination-container {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
    margin-top: 30px;
    margin-bottom: 30px;
  }

  .pagination {
    display: flex;
    gap: 10px;
    align-items: center;
  }

  .pagination-btn {
    background-color: #8f2f41;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: 0.3s ease;
  }

  .pagination-btn:hover:not(:disabled) {
    background-color: #a83e51;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(143, 47, 65, 0.3);
  }

  .pagination-btn:disabled {
    background-color: #d9d9d9;
    color: #999;
    cursor: not-allowed;
    opacity: 0.6;
  }

  .pagination-info {
    font-size: 14px;
    font-weight: 600;
    color: #333;
    min-width: 100px;
    text-align: center;
  }
</style>
{% endblock %} {% block content %}
<div class="inventory-header">
  <h1>Inventory Management System</h1>
  <div class="button-group">
    <button onclick="openAddMedicineModal()" class="btn">+ Add Medicine</button>

    >
  </div>
</div>

<!-- Summary Section -->
<div class="summary-cards">
  <div class="summary-card">
    <h3>Total Items</h3>
    <div class="count">0</div>
  </div>
  <div class="summary-card">
    <h3>Available Stock</h3>
    <div class="count">0</div>
  </div>
  <div class="summary-card warning">
    <h3>Low Stock Items</h3>
    <div class="count">0</div>
  </div>
  <div class="summary-card danger">
    <h3>Critical Stock</h3>
    <div class="count">0</div>
  </div>
</div>

<!-- Medicine Stocks Section -->
<h2 class="section-title"><i class="bx bx-capsule"></i>Medicine Stocks</h2>
<div class="search-container">
  <div class="search-input-group">
    <input
      type="text"
      id="medicineSearch"
      class="search-input"
      placeholder="Search by medicine name or supplier..."
      onkeyup="filterMedicineTable()"
    />
  </div>
</div>
<table id="medicineTable" class="inventory-table">
  <thead>
    <tr>
      <th>Medicine Name</th>
      <th>Quantity</th>
      <th>Unit</th>
      <th>Expiry Date</th>
      <th>Reorder Level</th>
      <th>Supplier</th>
      <th>Status</th>
      <th>Notes</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% set medicines = inventory|selectattr('category', 'equalto',
    'Medicine')|list %} {% if medicines %} {% for item in medicines %}
    <tr>
      <td class="item-name">{{ item['item_name'] }}</td>
      <td class="quantity-cell">
        {{ item['quantity'] }} {% if item['quantity'] > item['reorder_level'] *
        2 %}
        <span class="quantity-badge quantity-high">✓</span>
        {% elif item['quantity'] > item['reorder_level'] %}
        <span class="quantity-badge quantity-medium">⚠</span>
        {% else %}
        <span class="quantity-badge quantity-low">⚠</span>
        {% endif %}
      </td>
      <td>{{ item['unit'] }}</td>
      <td class="expiry-date">
        {% if item['expiry_date'] %} {% if item['expiry_date'] < '2025-03-01' %}
        <span class="expiry-soon">{{ item['expiry_date'] }}</span>
        {% else %} {{ item['expiry_date'] }} {% endif %} {% else %} N/A {% endif
        %}
      </td>
      <td>{{ item['reorder_level'] }}</td>
      <td class="supplier-info">{{ item['supplier'] }}</td>
      <td>
        <span
          class="status-badge {% if item['status']=='available' %}status-available{% else %}status-unavailable{% endif %}"
        >
          {{ item['status']|upper }}
        </span>
      </td>
      <td class="notes-cell">{{ item['notes'] }}</td>
      <td class="action-cell">
        <button
          type="button"
          class="btn btn-sm btn-danger delete-btn"
          data-type="medicine"
          data-id="{{ item['id'] }}"
          data-name="{{ item['item_name'] }}"
        >
          Delete
        </button>
      </td>
    </tr>
    {% endfor %} {% else %}
    <tr>
      <td colspan="9" class="empty-state">
        <p>No medicine items in inventory</p>
      </td>
    </tr>
    {% endif %}
  </tbody>
</table>

{% set medicine_count = inventory|selectattr('category', 'equalto',
'Medicine')|list|length %} {% if medicine_count > 7 %}
<div id="medicinePaginationContainer" class="pagination-container">
  <div class="pagination">
    <button
      id="prevMedicineBtn"
      class="pagination-btn"
      onclick="previousMedicinePage()"
    >
      ← Previous
    </button>
    <span class="pagination-info">
      Page <span id="medicineCurrentPage">1</span> of
      <span id="medicineTotalPages">1</span>
    </span>
    <button
      id="nextMedicineBtn"
      class="pagination-btn"
      onclick="nextMedicinePage()"
    >
      Next →
    </button>
  </div>
</div>
{% endif %}

<!-- Supplies & Materials Section -->
<h2 class="section-title"><i class="bx bx-package"></i>Supplies & Materials</h2>
<div class="search-container">
  <div class="search-input-group">
    <input
      type="text"
      id="supplySearch"
      class="search-input"
      placeholder="Search by supply name or supplier..."
      onkeyup="filterSupplyTable()"
    />
  </div>
</div>
<table id="supplyTable" class="inventory-table">
  <thead>
    <tr>
      <th>Supply Name</th>
      <th>Quantity</th>
      <th>Unit</th>
      <th>Expiry Date</th>
      <th>Reorder Level</th>
      <th>Supplier</th>
      <th>Status</th>
      <th>Notes</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% set supplies = inventory|selectattr('category', 'equalto',
    'Supplies')|list %} {% if supplies %} {% for item in supplies %}
    <tr>
      <td class="item-name">{{ item['item_name'] }}</td>
      <td class="quantity-cell">
        {{ item['quantity'] }} {% if item['quantity'] > item['reorder_level'] *
        2 %}
        <span class="quantity-badge quantity-high">✓</span>
        {% elif item['quantity'] > item['reorder_level'] %}
        <span class="quantity-badge quantity-medium">⚠</span>
        {% else %}
        <span class="quantity-badge quantity-low">⚠</span>
        {% endif %}
      </td>
      <td>{{ item['unit'] }}</td>
      <td class="expiry-date">
        {% if item['expiry_date'] %} {% if item['expiry_date'] < '2025-03-01' %}
        <span class="expiry-soon">{{ item['expiry_date'] }}</span>
        {% else %} {{ item['expiry_date'] }} {% endif %} {% else %} N/A {% endif
        %}
      </td>
      <td>{{ item['reorder_level'] }}</td>
      <td class="supplier-info">{{ item['supplier'] }}</td>
      <td>
        <span
          class="status-badge {% if item['status']=='available' %}status-available{% else %}status-unavailable{% endif %}"
        >
          {{ item['status']|upper }}
        </span>
      </td>
      <td class="notes-cell">{{ item['notes'] }}</td>
      <td class="action-cell">
        <button
          type="button"
          class="btn btn-sm btn-danger delete-btn"
          data-type="supply"
          data-id="{{ item['id'] }}"
          data-name="{{ item['item_name'] }}"
        >
          Delete
        </button>
      </td>
    </tr>
    {% endfor %} {% else %}
    <tr>
      <td colspan="9" class="empty-state">
        <p>No supplies in inventory</p>
      </td>
    </tr>
    {% endif %}
  </tbody>
</table>

{% set supply_count = inventory|selectattr('category', 'equalto',
'Supplies')|list|length %} {% if supply_count > 7 %}
<div id="supplyPaginationContainer" class="pagination-container">
  <div class="pagination">
    <button
      id="prevSupplyBtn"
      class="pagination-btn"
      onclick="previousSupplyPage()"
    >
      ← Previous
    </button>
    <span class="pagination-info">
      Page <span id="supplyCurrentPage">1</span> of
      <span id="supplyTotalPages">1</span>
    </span>
    <button
      id="nextSupplyBtn"
      class="pagination-btn"
      onclick="nextSupplyPage()"
    >
      Next →
    </button>
  </div>
</div>
{% endif %}

<!-- Add Medicine Modal -->
<div id="addMedicineModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Add New Medicine</h2>
      <button class="modal-close" onclick="closeAddMedicineModal()">
        &times;
      </button>
    </div>

    <form
      id="addMedicineForm"
      class="form-group-modal"
      onsubmit="return validateInventoryMedicineForm()"
    >
      <!-- Item Name & Category -->
      <div class="form-row-modal">
        <div>
          <label for="item_name"
            >Medicine Name <span class="required">*</span></label
          >
          <input
            type="text"
            id="item_name"
            name="item_name"
            placeholder="e.g., Paracetamol"
            required
            minlength="3"
            maxlength="100"
            pattern="[a-zA-Z0-9\s\-]+"
          />
        </div>
        <div>
          <label for="category">Category <span class="required">*</span></label>
          <select id="category" name="category" required>
            <option value="">Select Category</option>
            <option value="Medicine">Medicine</option>
            <option value="Supplies">Supplies</option>
          </select>
        </div>
      </div>

      <!-- Quantity & Unit -->
      <div class="form-row-modal">
        <div>
          <label for="quantity">Quantity <span class="required">*</span></label>
          <input
            type="number"
            id="quantity"
            name="quantity"
            placeholder="e.g., 100"
            min="1"
            max="999999"
            required
          />
          <p class="help-text">Current stock quantity</p>
        </div>
        <div>
          <label for="unit">Unit <span class="required">*</span></label>
          <select id="unit" name="unit" required>
            <option value="">Select Unit</option>
            <option value="tablets">Tablets</option>
            <option value="capsules">Capsules</option>
            <option value="ml">ML</option>
            <option value="bottles">Bottles</option>
            <option value="boxes">Boxes</option>
            <option value="units">Units</option>
            <option value="packs">Packs</option>
            <option value="strips">Strips</option>
          </select>
        </div>
      </div>

      <!-- Status & Expiry Date -->
      <div class="form-row-modal">
        <div>
          <label for="status">Status</label>
          <select id="status" name="status">
            <option value="available">Available</option>
            <option value="unavailable">Unavailable</option>
          </select>
        </div>
        <div>
          <label for="expiry_date">Expiry Date</label>
          <input type="date" id="expiry_date" name="expiry_date" />
          <p class="help-text">Leave blank if not applicable</p>
        </div>
      </div>

      <!-- Reorder Level & Supplier -->
      <div class="form-row-modal">
        <div>
          <label for="reorder_level"
            >Reorder Level <span class="required">*</span></label
          >
          <input
            type="number"
            id="reorder_level"
            name="reorder_level"
            placeholder="e.g., 20"
            min="0"
            value="0"
            required
          />
          <p class="help-text">Minimum quantity before reordering</p>
        </div>
        <div>
          <label for="supplier">Supplier</label>
          <input
            type="text"
            id="supplier"
            name="supplier"
            placeholder="e.g., Medical Supply Co."
          />
        </div>
      </div>

      <!-- Notes -->
      <div>
        <label for="notes">Notes</label>
        <textarea
          id="notes"
          name="notes"
          placeholder="Additional notes or special instructions..."
        ></textarea>
      </div>

      <!-- Buttons -->
      <div class="modal-buttons">
        <button type="submit" class="btn-submit-modal">✓ Add Medicine</button>
        <button
          type="button"
          class="btn-cancel-modal"
          onclick="closeAddMedicineModal()"
        >
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  function openAddMedicineModal() {
    document.getElementById("addMedicineModal").classList.add("show");
  }

  function closeAddMedicineModal() {
    document.getElementById("addMedicineModal").classList.remove("show");
  }

  // Handle add medicine form submission
  const addForm = document.getElementById("addMedicineForm");
  if (addForm) {
    addForm.addEventListener("submit", function (e) {
      e.preventDefault();

      const formData = new FormData(this);

      fetch("{{ url_for('add_medicine') }}", {
        method: "POST",
        body: formData,
      })
        .then((response) => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then((data) => {
          if (data.success) {
            Swal.fire({
              icon: "success",
              title: "Success",
              text: "Medicine added successfully!",
              timer: 1500,
            });
            // Reset form
            document.getElementById("addMedicineForm").reset();
            // Close modal
            closeAddMedicineModal();
            // Reload the page to show new item
            setTimeout(() => {
              location.reload();
            }, 500);
          } else {
            Swal.fire({
              icon: "error",
              title: "Error",
              text: data.message || "Unknown error",
            });
          }
        })
        .catch((error) => {
          console.error("Error:", error);
          Swal.fire({
            icon: "error",
            title: "Error",
            text:
              "An error occurred while adding the medicine: " + error.message,
          });
        });
    });
  } else {
    console.error("addMedicineForm not found");
  }

  // Close modal when clicking outside of it
  window.onclick = function (event) {
    const modal = document.getElementById("addMedicineModal");
    if (event.target == modal) {
      modal.classList.remove("show");
    }
  };

  // Delete button event handler
  document.querySelectorAll(".delete-btn").forEach((button) => {
    button.addEventListener("click", function () {
      const type = this.dataset.type;
      const id = this.dataset.id;
      const name = this.dataset.name;
      openInventoryDeleteModal(type, id, name);
    });
  });

  // Delete Inventory Modal Functions
  let deleteInventoryData = { type: null, id: null };

  function openInventoryDeleteModal(type, id, name) {
    deleteInventoryData.type = type;
    deleteInventoryData.id = id;
    document.getElementById("inventoryDeleteModalName").textContent = name;
    document.getElementById("inventoryDeleteModal").classList.add("show");
  }

  function closeInventoryDeleteModal() {
    document.getElementById("inventoryDeleteModal").classList.remove("show");
  }

  function confirmInventoryDelete() {
    const id = deleteInventoryData.id;
    fetch(`/delete_medicine/${id}`, {
      method: "POST",
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.success) {
          closeInventoryDeleteModal();
          // Reload after 300ms to ensure backend transaction completes
          setTimeout(() => {
            window.location.href = window.location.href;
          }, 300);
        } else {
          Swal.fire({
            icon: "error",
            title: "Error",
            text: data.message,
          });
        }
      })
      .catch((error) => {
        console.error("Error:", error);
        Swal.fire({
          icon: "error",
          title: "Error",
          text: "An error occurred while deleting the item",
        });
      });
  }

  // Close delete modal when clicking outside
  document.addEventListener("click", function (event) {
    const deleteModal = document.getElementById("inventoryDeleteModal");
    if (event.target === deleteModal) {
      closeInventoryDeleteModal();
    }
  });

  // Pagination and Filter Functions
  const itemsPerPage = 7;
  let currentMedicinePage = 1;
  let currentSupplyPage = 1;

  function filterMedicineTable() {
    const searchInput = document
      .getElementById("medicineSearch")
      .value.toLowerCase();
    const table = document.getElementById("medicineTable");
    const rows = table
      .getElementsByTagName("tbody")[0]
      .getElementsByTagName("tr");
    let visibleCount = 0;

    for (let i = 0; i < rows.length; i++) {
      const nameCell = rows[i].getElementsByTagName("td")[0];
      const supplierCell = rows[i].getElementsByTagName("td")[5];
      if (nameCell && supplierCell) {
        const nameValue = nameCell.textContent.toLowerCase();
        const supplierValue = supplierCell.textContent.toLowerCase();
        if (
          nameValue.includes(searchInput) ||
          supplierValue.includes(searchInput)
        ) {
          rows[i].style.display = "";
          visibleCount++;
        } else {
          rows[i].style.display = "none";
        }
      }
    }

    // Reset to page 1 when filtering
    currentMedicinePage = 1;
    if (document.getElementById("medicinePaginationContainer")) {
      paginateMedicine(1);
    }
  }

  function filterSupplyTable() {
    const searchInput = document
      .getElementById("supplySearch")
      .value.toLowerCase();
    const table = document.getElementById("supplyTable");
    const rows = table
      .getElementsByTagName("tbody")[0]
      .getElementsByTagName("tr");
    let visibleCount = 0;

    for (let i = 0; i < rows.length; i++) {
      const nameCell = rows[i].getElementsByTagName("td")[0];
      const supplierCell = rows[i].getElementsByTagName("td")[5];
      if (nameCell && supplierCell) {
        const nameValue = nameCell.textContent.toLowerCase();
        const supplierValue = supplierCell.textContent.toLowerCase();
        if (
          nameValue.includes(searchInput) ||
          supplierValue.includes(searchInput)
        ) {
          rows[i].style.display = "";
          visibleCount++;
        } else {
          rows[i].style.display = "none";
        }
      }
    }

    // Reset to page 1 when filtering
    currentSupplyPage = 1;
    if (document.getElementById("supplyPaginationContainer")) {
      paginateSupply(1);
    }
  }

  function paginateMedicine(page) {
    const table = document.getElementById("medicineTable");
    const rows = Array.from(
      table.getElementsByTagName("tbody")[0].getElementsByTagName("tr")
    ).filter((row) => row.style.display !== "none");

    const totalPages = Math.ceil(rows.length / itemsPerPage);
    const startIndex = (page - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;

    // Hide all rows first
    table
      .getElementsByTagName("tbody")[0]
      .getElementsByTagName("tr")
      .forEach((row) => {
        if (row.style.display !== "none") {
          row.style.display = "none";
        }
      });

    // Show only rows for current page
    let visibleIndex = 0;
    Array.from(
      table.getElementsByTagName("tbody")[0].getElementsByTagName("tr")
    ).forEach((row) => {
      if (
        row.querySelector("td") &&
        row.querySelector("td").textContent.length > 0
      ) {
        const medicineNameCell = row.getElementsByTagName("td")[0];
        if (medicineNameCell.textContent.length > 0) {
          if (visibleIndex >= startIndex && visibleIndex < endIndex) {
            row.style.display = "";
          }
          visibleIndex++;
        }
      }
    });

    // Update pagination display
    if (document.getElementById("medicineCurrentPage")) {
      document.getElementById("medicineCurrentPage").textContent = page;
      document.getElementById("medicineTotalPages").textContent = totalPages;
      document.getElementById("prevMedicineBtn").disabled = page === 1;
      document.getElementById("nextMedicineBtn").disabled = page === totalPages;
    }

    currentMedicinePage = page;
  }

  function paginateSupply(page) {
    const table = document.getElementById("supplyTable");
    const rows = Array.from(
      table.getElementsByTagName("tbody")[0].getElementsByTagName("tr")
    ).filter((row) => row.style.display !== "none");

    const totalPages = Math.ceil(rows.length / itemsPerPage);
    const startIndex = (page - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;

    // Hide all rows first
    table
      .getElementsByTagName("tbody")[0]
      .getElementsByTagName("tr")
      .forEach((row) => {
        if (row.style.display !== "none") {
          row.style.display = "none";
        }
      });

    // Show only rows for current page
    let visibleIndex = 0;
    Array.from(
      table.getElementsByTagName("tbody")[0].getElementsByTagName("tr")
    ).forEach((row) => {
      if (
        row.querySelector("td") &&
        row.querySelector("td").textContent.length > 0
      ) {
        const supplyNameCell = row.getElementsByTagName("td")[0];
        if (supplyNameCell.textContent.length > 0) {
          if (visibleIndex >= startIndex && visibleIndex < endIndex) {
            row.style.display = "";
          }
          visibleIndex++;
        }
      }
    });

    // Update pagination display
    if (document.getElementById("supplyCurrentPage")) {
      document.getElementById("supplyCurrentPage").textContent = page;
      document.getElementById("supplyTotalPages").textContent = totalPages;
      document.getElementById("prevSupplyBtn").disabled = page === 1;
      document.getElementById("nextSupplyBtn").disabled = page === totalPages;
    }

    currentSupplyPage = page;
  }

  function previousMedicinePage() {
    if (currentMedicinePage > 1) {
      paginateMedicine(currentMedicinePage - 1);
    }
  }

  function nextMedicinePage() {
    const table = document.getElementById("medicineTable");
    const rows = Array.from(
      table.getElementsByTagName("tbody")[0].getElementsByTagName("tr")
    ).filter((row) => row.style.display !== "none");
    const totalPages = Math.ceil(rows.length / itemsPerPage);
    if (currentMedicinePage < totalPages) {
      paginateMedicine(currentMedicinePage + 1);
    }
  }

  function previousSupplyPage() {
    if (currentSupplyPage > 1) {
      paginateSupply(currentSupplyPage - 1);
    }
  }

  function nextSupplyPage() {
    const table = document.getElementById("supplyTable");
    const rows = Array.from(
      table.getElementsByTagName("tbody")[0].getElementsByTagName("tr")
    ).filter((row) => row.style.display !== "none");
    const totalPages = Math.ceil(rows.length / itemsPerPage);
    if (currentSupplyPage < totalPages) {
      paginateSupply(currentSupplyPage + 1);
    }
  }

  // Update summary counts on page load
  function updateSummaryCounts() {
    // Count total items (all rows in all tables except empty state rows)
    const allRows = document.querySelectorAll(
      ".inventory-table tbody tr:not(.empty-state)"
    );
    let totalItems = 0;
    let availableItems = 0;
    let lowStockItems = 0;
    let criticalStockItems = 0;

    allRows.forEach((row) => {
      totalItems++;
      const statusCell = row.querySelector('[class*="status-"]');
      if (statusCell && statusCell.classList.contains("status-available")) {
        availableItems++;
      }

      const quantityCell = row.querySelector(".quantity-cell");
      if (quantityCell) {
        const quantity = parseInt(quantityCell.textContent);
        if (quantity <= 2) {
          criticalStockItems++;
        } else if (quantity <= 5) {
          lowStockItems++;
        }
      }
    });

    // Update the display
    const countElements = document.querySelectorAll(".summary-card .count");
    if (countElements.length >= 4) {
      countElements[0].textContent = totalItems;
      countElements[1].textContent = availableItems;
      countElements[2].textContent = lowStockItems;
      countElements[3].textContent = criticalStockItems;
    }
  }

  // Update counts on page load
  updateSummaryCounts();

  // Initialize pagination on page load
  document.addEventListener("DOMContentLoaded", function () {
    const medicineTable = document.getElementById("medicineTable");
    const supplyTable = document.getElementById("supplyTable");

    if (
      medicineTable &&
      document.getElementById("medicinePaginationContainer")
    ) {
      paginateMedicine(1);
    }

    if (supplyTable && document.getElementById("supplyPaginationContainer")) {
      paginateSupply(1);
    }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- Delete Inventory Modal -->
<div id="inventoryDeleteModal" class="delete-modal">
  <div class="delete-modal-content">
    <div class="delete-modal-header">
      <i class="bx bxs-error-circle"></i>
      <h3>Confirm Delete</h3>
      <button class="modal-close" onclick="closeInventoryDeleteModal()">
        ×
      </button>
    </div>
    <div class="delete-modal-body">
      <p>
        Are you sure you want to delete
        <strong id="inventoryDeleteModalName"></strong>?
      </p>
      <p style="color: #666; font-size: 12px; margin-top: 10px">
        This action cannot be undone.
      </p>
    </div>
    <div class="delete-modal-buttons">
      <button class="btn-cancel" onclick="closeInventoryDeleteModal()">
        Cancel
      </button>
      <button class="btn-confirm-delete" onclick="confirmInventoryDelete()">
        Delete
      </button>
    </div>
  </div>
</div>

{% endblock %}
